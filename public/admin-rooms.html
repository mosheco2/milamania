<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>××™×œ×× ×™×” - × ×™×”×•×œ ×—×“×¨×™× ×•×‘×× ×¨×™×</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">
  <style>
     :root { font-size: 16px; --bg-color: #FFF8EA; }
     * { box-sizing: border-box; font-family: "Varela Round", sans-serif; -webkit-tap-highlight-color: transparent; }
     body { margin: 0; padding: 20px; background-color: var(--bg-color); color: #2B1E4A; font-family: "Varela Round", sans-serif; min-height: 100vh; }
     .container { max-width: 900px; margin: 0 auto; background: #fff; padding: 25px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
     h1 { text-align: center; margin-top: 0; color: #F84779; }
     h2 { margin-top: 30px; color: #2B1E4A; border-bottom: 2px solid #eee; padding-bottom: 10px; }
     .section { margin-bottom: 30px; background: #F8F7FF; padding: 20px; border-radius: 16px; }
     label { display: block; margin-bottom: 5px; font-weight: bold; color: #5a507a; }
     input, select, textarea { width: 100%; padding: 12px; border-radius: 12px; border: 2px solid #eee; font-size: 1rem; margin-bottom: 15px; }
     input:focus, select:focus, textarea:focus { border-color: #F84779; outline: none; }
     .btn { padding: 12px 24px; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.2s; }
     .btn:active { transform: scale(0.98); }
     .btn-save { background: linear-gradient(135deg, #F84779, #FF8566); color: white; width: 100%; }
     .btn-refresh { background: linear-gradient(135deg, #15C4C1, #42E695); color: white; margin-bottom: 15px; }
     .btn-wa { background: #25D366; color: white; text-decoration: none; display: inline-block; text-align: center; }
     .banner-preview { max-width: 100%; height: auto; max-height: 150px; border-radius: 12px; margin-top: 10px; display: block; border: 2px dashed #ccc; }
     .room-item { background: #fff; padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
     .status-active { color: #25D366; font-weight: bold; }
     .status-inactive { color: #EF4444; font-weight: bold; }
     .brand-preview-box { border: 1px solid #eee; padding: 20px; border-radius: 16px; text-align: center; background: var(--preview-bg, #FFF8EA); margin-top: 20px; }
     .brand-logo-prev { max-height: 100px; margin-bottom: 10px; }
  </style>
</head>
<body>
  <div class="container">
      <h1>××™×œ×× ×™×” - × ×™×”×•×œ ğŸ› ï¸</h1>

      <div class="section">
          <h2>× ×™×”×•×œ ×‘×× ×¨×™× ×’×œ×•×‘×œ×™×™×</h2>
          <p style="font-size:0.9rem; color:#666;">×‘×× ×¨×™× ××œ×• ×™×•×¤×™×¢×• ×‘×›×œ ×“×¤×™ ×”××©×—×§ ×©××™× × ×××•×ª×’×™×.</p>
          
          <h3>×‘×× ×¨ ×¢×œ×™×•×Ÿ</h3>
          <label>×›×ª×•×‘×ª ×ª××•× ×” (Desktop)</label>
          <input type="text" id="topBannerImg" placeholder="https://example.com/banner_desktop.jpg">
          <label>×›×ª×•×‘×ª ×ª××•× ×” (Mobile)</label>
          <input type="text" id="topBannerImgMobile" placeholder="https://example.com/banner_mobile.jpg">
          <label>×§×™×©×•×¨ ×™×¢×“</label>
          <input type="text" id="topBannerLink" placeholder="https://example.com/target-page">
          <img id="topBannerPreview" src="" class="banner-preview" alt="×ª×¦×•×’×” ××§×“×™××”" onerror="this.style.display='none'">

          <h3>×‘×× ×¨ ×ª×—×ª×•×Ÿ</h3>
          <label>×›×ª×•×‘×ª ×ª××•× ×” (Desktop)</label>
          <input type="text" id="bottomBannerImg" placeholder="https://example.com/banner_desktop.jpg">
          <label>×›×ª×•×‘×ª ×ª××•× ×” (Mobile)</label>
          <input type="text" id="bottomBannerImgMobile" placeholder="https://example.com/banner_mobile.jpg">
          <label>×§×™×©×•×¨ ×™×¢×“</label>
          <input type="text" id="bottomBannerLink" placeholder="https://example.com/target-page">
          <img id="bottomBannerPreview" src="" class="banner-preview" alt="×ª×¦×•×’×” ××§×“×™××”" onerror="this.style.display='none'">

          <button id="saveBannersBtn" class="btn btn-save" style="margin-top:20px;">×©××•×¨ ×‘×× ×¨×™×</button>
      </div>

      <div class="section">
          <h2>××—×•×œ×œ ××•×ª×’ (Branding Gen)</h2>
          <label>×›×•×ª×¨×ª ×”××•×ª×’</label>
          <input type="text" id="brandTitle" placeholder="×œ×“×•×’××”: ×‘× ×§ ×”×¤×•×¢×œ×™×">
          <label>×¡×œ×•×’×Ÿ</label>
          <input type="text" id="brandSlogan" placeholder="×œ×”×™×•×ª ×¨××©×•×Ÿ ×–×” ××—×™×™×‘">
          <label>×›×ª×•×‘×ª ×œ×•×’×•</label>
          <input type="text" id="brandLogo" placeholder="https://example.com/logo.png">
          <label>×¦×‘×¢ ×¨×§×¢ (×”×§×¡×“×¦×™××œ×™)</label>
          <input type="color" id="brandColor" value="#FFF8EA" style="height:50px; padding:5px;">
          
          <div class="brand-preview-box" id="brandPreview">
              <img id="brandLogoPrev" class="brand-logo-prev" src="" style="display:none;">
              <h3 id="brandTitlePrev" style="margin:10px 0 5px;">×›×•×ª×¨×ª ×”××•×ª×’</h3>
              <p id="brandSloganPrev" style="margin:0; color:#666;">×¡×œ×•×’×Ÿ ×”××•×ª×’</p>
          </div>

          <label style="margin-top:20px;">×§×™×©×•×¨ ×××•×ª×’ ×œ×™×¦×™×¨×ª ××©×—×§</label>
          <div style="display:flex; gap:10px;">
              <input type="text" id="generatedLink" readonly style="margin-bottom:0;">
              <a id="shareWaBtn" class="btn btn-wa" href="#" target="_blank" style="display:none;">×©×œ×— ×‘×•×•×¦××¤</a>
          </div>
      </div>

      <div class="section">
          <h2>×—×“×¨×™× ×¤×¢×™×œ×™×</h2>
          <button id="refreshRoomsBtn" class="btn btn-refresh">ğŸ”„ ×¨×¢× ×Ÿ ×¨×©×™××”</button>
          <div id="roomsList">
              <p>×˜×•×¢×Ÿ...</p>
          </div>
      </div>
  </div>

  <script>
      const API_BANNERS = "/api/banners"; // ×©×™× ×œ×‘: ×™×© ×œ×¢×“×›×Ÿ ××ª ×¦×“ ×”×©×¨×ª ×œ×ª××™×›×” ×‘×©××™×¨×ª ×‘×× ×¨×™× ×œ××•×‘×™×™×œ
      const API_ADMIN_STATS = "/admin/stats?code=ONEBTN"; // ×™×© ×œ×•×•×“× ×©×§×•×“ ×”××“××™×Ÿ ×ª×•×× ×œ×©×¨×ª

      // --- ×˜×¢×™× ×” ×•×©××™×¨×” ×©×œ ×‘×× ×¨×™× ---
      async function loadBanners() {
          try {
              const res = await fetch(API_BANNERS);
              const data = await res.json();
              if (data.topBanner) {
                  document.getElementById('topBannerImg').value = data.topBanner.img || '';
                  document.getElementById('topBannerImgMobile').value = data.topBanner.imgMobile || ''; // ×©×“×” ×—×“×©
                  document.getElementById('topBannerLink').value = data.topBanner.link || '';
                  updatePreview('topBannerImg', 'topBannerPreview');
              }
              if (data.bottomBanner) {
                  document.getElementById('bottomBannerImg').value = data.bottomBanner.img || '';
                  document.getElementById('bottomBannerImgMobile').value = data.bottomBanner.imgMobile || ''; // ×©×“×” ×—×“×©
                  document.getElementById('bottomBannerLink').value = data.bottomBanner.link || '';
                  updatePreview('bottomBannerImg', 'bottomBannerPreview');
              }
          } catch (e) { console.error("Error loading banners:", e); }
      }

      async function saveBanners() {
          const banners = {
              topBanner: {
                  img: document.getElementById('topBannerImg').value.trim(),
                  imgMobile: document.getElementById('topBannerImgMobile').value.trim(), // ×©×“×” ×—×“×©
                  link: document.getElementById('topBannerLink').value.trim()
              },
              bottomBanner: {
                  img: document.getElementById('bottomBannerImg').value.trim(),
                  imgMobile: document.getElementById('bottomBannerImgMobile').value.trim(), // ×©×“×” ×—×“×©
                  link: document.getElementById('bottomBannerLink').value.trim()
              }
          };
          try {
              await fetch(API_BANNERS, {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify(banners)
              });
              alert('×”×‘×× ×¨×™× × ×©××¨×• ×‘×”×¦×œ×—×”!');
          } catch (e) { alert('×©×’×™××” ×‘×©××™×¨×”'); console.error(e); }
      }

      function updatePreview(inputId, imgId) {
          const url = document.getElementById(inputId).value.trim();
          const img = document.getElementById(imgId);
          if (url) { img.src = url; img.style.display = 'block'; }
          else { img.style.display = 'none'; }
      }

      document.getElementById('topBannerImg').addEventListener('input', () => updatePreview('topBannerImg', 'topBannerPreview'));
      document.getElementById('bottomBannerImg').addEventListener('input', () => updatePreview('bottomBannerImg', 'bottomBannerPreview'));
      document.getElementById('saveBannersBtn').addEventListener('click', saveBanners);

      // --- ××—×•×œ×œ ××•×ª×’ ---
      function generateLink() {
          const title = encodeURIComponent(document.getElementById('brandTitle').value.trim());
          const slogan = encodeURIComponent(document.getElementById('brandSlogan').value.trim());
          const logo = encodeURIComponent(document.getElementById('brandLogo').value.trim());
          const color = document.getElementById('brandColor').value.substring(1);
          
          let link = `${window.location.origin}/host.html?`;
          if(title) link += `title=${title}&`;
          if(slogan) link += `slogan=${slogan}&`;
          if(logo) link += `logo=${logo}&`;
          if(color) link += `color=${color}`;

          document.getElementById('generatedLink').value = link;
          
          if(link.includes('=')) {
              const waText = `×”×™×™, ×™×¦×¨×ª×™ ×œ×™× ×§ ×œ××©×—×§ ×××•×ª×’!\n×›× ×¡×• ××›××Ÿ:\n${link}`;
              document.getElementById('shareWaBtn').href = `https://wa.me/?text=${encodeURIComponent(waText)}`;
              document.getElementById('shareWaBtn').style.display = 'flex';
          } else {
              document.getElementById('shareWaBtn').style.display = 'none';
          }

          // ×¢×“×›×•×Ÿ ×ª×¦×•×’×” ××§×“×™××”
          document.getElementById('brandPreview').style.setProperty('--preview-bg', '#' + color);
          const titleVal = document.getElementById('brandTitle').value.trim();
          document.getElementById('brandTitlePrev').textContent = titleVal || '×›×•×ª×¨×ª ×”××•×ª×’';
          const sloganVal = document.getElementById('brandSlogan').value.trim();
          document.getElementById('brandSloganPrev').textContent = sloganVal || (sloganVal === '' && titleVal === '' ? '×¡×œ×•×’×Ÿ ×”××•×ª×’' : '');
          const logoVal = document.getElementById('brandLogo').value.trim();
          const logoImg = document.getElementById('brandLogoPrev');
          if(logoVal) { logoImg.src = logoVal; logoImg.style.display = 'inline-block'; }
          else { logoImg.style.display = 'none'; }
      }

      ['brandTitle', 'brandSlogan', 'brandLogo', 'brandColor'].forEach(id => {
          document.getElementById(id).addEventListener('input', generateLink);
      });

      // --- × ×™×”×•×œ ×—×“×¨×™× ---
      async function loadRooms() {
          const list = document.getElementById('roomsList');
          list.innerHTML = '<p>×˜×•×¢×Ÿ...</p>';
          try {
              const res = await fetch(API_ADMIN_STATS);
              const data = await res.json();
              if (!data || !data.activeGames || data.activeGames.length === 0) {
                  list.innerHTML = '<p>××™×Ÿ ×—×“×¨×™× ×¤×¢×™×œ×™× ×›×¨×’×¢.</p>';
                  return;
              }
              
              let html = '';
              data.activeGames.forEach(g => {
                  const statusClass = g.playerCount > 0 ? 'status-active' : 'status-inactive';
                  const statusText = g.playerCount > 0 ? '×¤×¢×™×œ' : '×××ª×™×Ÿ';
                  html += `
                      <div class="room-item">
                          <div>
                              <strong>×§×•×“: ${g.code}</strong> | ×× ×”×œ: ${g.hostName} | ×›×•×ª×¨×ª: ${g.gameTitle || '-'} | 
                              <span class="${statusClass}">${statusText}</span>
                          </div>
                          <div>
                              ×©×—×§× ×™×: ${g.playerCount} | ×§×‘×•×¦×•×ª: ${g.teamCount} | × ×•×¦×¨: ${new Date(g.createdAt).toLocaleTimeString()}
                          </div>
                          <div>
                              <a href="/host.html?code=${g.code}" target="_blank" class="btn btn-wa" style="padding:6px 12px; font-size:0.9rem;">×›× ×¡ ×œ×—×“×¨ ×›×× ×”×œ</a>
                          </div>
                      </div>
                  `;
              });
              list.innerHTML = html;
          } catch (e) {
              list.innerHTML = '<p style="color:red;">×©×’×™××” ×‘×˜×¢×™× ×ª ×—×“×¨×™×.</p>';
              console.error(e);
          }
      }

      document.getElementById('refreshRoomsBtn').addEventListener('click', loadRooms);

      // ×˜×¢×™× ×” ×¨××©×•× ×™×ª
      loadBanners();
      loadRooms();
  </script>
</body>
</html>
