<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>כהנ'ס - ניהול לוגו ובאנרים</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      padding: 0;
      background: #020617;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }
    .app {
      max-width: 960px;
      width: 100%;
      padding: 20px 16px 40px;
    }
    .card {
      background: #020617;
      border-radius: 20px;
      padding: 16px 16px 18px;
      box-shadow: 0 18px 45px rgba(0,0,0,0.85);
      border: 1px solid rgba(148,163,184,0.25);
      margin-bottom: 16px;
    }
    h1, h2, h3 {
      margin-top: 0;
    }
    label {
      display: block;
      margin-bottom: 2px;
      font-size: 0.8rem;
      color: #9ca3af;
    }
    input {
      width: 100%;
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.85rem;
    }
    input:focus {
      outline: none;
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px #38bdf8;
    }
    .row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 8px;
    }
    .row > div {
      flex: 1 1 220px;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.15s ease;
      white-space: nowrap;
    }
    .btn-primary {
      background: linear-gradient(135deg, #38bdf8, #0ea5e9);
      color: #020617;
      box-shadow: 0 10px 25px rgba(56,189,248,0.35);
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 35px rgba(56,189,248,0.5);
    }
    .status {
      font-size: 0.8rem;
      margin-top: 6px;
    }
    .status.ok {
      color: #4ade80;
    }
    .status.err {
      color: #f97373;
    }
    .preview {
      margin-top: 6px;
      font-size: 0.8rem;
      color: #9ca3af;
    }
    .preview img {
      max-width: 220px;
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,0.4);
      display: block;
      margin-top: 4px;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .chip {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.4);
      font-size: 0.78rem;
      color: #cbd5f5;
      gap: 6px;
      background: radial-gradient(circle at top left, rgba(56,189,248,0.22), rgba(15,23,42,0.95));
    }
    .btn-link {
      background: transparent;
      border: 1px solid #4b5563;
      color: #e5e7eb;
      font-size: 0.8rem;
      padding: 5px 10px;
    }
    .btn-link:hover {
      background: rgba(15,23,42,0.9);
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- כותרת + קוד מנהל -->
    <div class="card">
      <div class="top-bar">
        <div>
          <div class="chip">כהנ'ס · ניהול לוגו ובאנרים</div>
          <h1 style="margin:6px 0 4px; font-size:1.4rem;">מסך ניהול גרפי</h1>
          <p style="font-size:0.85rem; color:#9ca3af; margin:0;">
            כאן מגדירים לוגו כלל־מערכתי ובאנרים לעמוד הבית, מסך המנהל ומסך השחקנים.
          </p>
        </div>
        <button class="btn btn-link" onclick="location.href='/'">⬅ חזרה למשחק</button>
      </div>

      <div style="max-width:260px; margin-top:12px;">
        <label for="adminCode">קוד מנהל (admin code)</label>
        <input id="adminCode" type="password" placeholder="cohens1234 או מה שהגדרת בשרת" />
      </div>
      <button id="saveBtn" class="btn btn-primary" style="margin-top:10px;">שמירת הגדרות</button>
      <div id="saveStatus" class="status"></div>
    </div>

    <!-- לוגו ראשי -->
    <div class="card">
      <h3>לוגו ראשי</h3>
      <p style="font-size:0.8rem; color:#9ca3af; margin-top:0;">
        הלוגו יופיע בגדול בעמוד הבית ובגודל קטן במסך המנהל ובמסך השחקן.
        מומלץ: קובץ PNG שקוף, גובה בערך 60–120 פיקסלים.
      </p>
      <div class="row">
        <div>
          <label for="logoImageUrl">כתובת תמונה (URL)</label>
          <input id="logoImageUrl" type="text" placeholder="/cohens-logo.png" />
        </div>
        <div>
          <label for="logoAltText">טקסט אלטרנטיבי (ALT)</label>
          <input id="logoAltText" type="text" placeholder="כהנ'ס - Alias Party" />
        </div>
      </div>
      <div class="preview">
        תצוגה מקדימה:
        <img id="logoPreview" src="" alt="" style="display:none;" />
      </div>
    </div>

    <!-- באנר עמוד בית -->
    <div class="card">
      <h3>באנר - עמוד הבית</h3>
      <p style="font-size:0.8rem; color:#9ca3af; margin-top:0;">
        הבאנר יוצג בעמוד הבית מתחת לכפתורי המנהל/שחקן.
      </p>
      <div class="row">
        <div>
          <label for="indexImageUrl">כתובת תמונה (URL)</label>
          <input id="indexImageUrl" type="text" placeholder="/madanei-karmela-banner.png" />
        </div>
        <div>
          <label for="indexLinkUrl">קישור בלחיצה</label>
          <input id="indexLinkUrl" type="text" placeholder="https://example.com" />
        </div>
      </div>
      <div class="preview">
        תצוגה מקדימה:
        <img id="indexPreview" src="" alt="" style="display:none;" />
      </div>
    </div>

    <!-- באנר מסך מנהל -->
    <div class="card">
      <h3>באנר - מסך מנהל</h3>
      <p style="font-size:0.8rem; color:#9ca3af; margin-top:0;">
        הבאנר יוצג במסך ניהול המשחק (host.html).
      </p>
      <div class="row">
        <div>
          <label for="hostImageUrl">כתובת תמונה (URL)</label>
          <input id="hostImageUrl" type="text" placeholder="/host-banner.png" />
        </div>
        <div>
          <label for="hostLinkUrl">קישור בלחיצה</label>
          <input id="hostLinkUrl" type="text" placeholder="https://example.com" />
        </div>
      </div>
      <div class="preview">
        תצוגה מקדימה:
        <img id="hostPreview" src="" alt="" style="display:none;" />
      </div>
    </div>

    <!-- באנר מסך שחקן -->
    <div class="card">
      <h3>באנר - מסך שחקן</h3>
      <p style="font-size:0.8rem; color:#9ca3af; margin-top:0;">
        הבאנר יוצג באיזור הניקוד במסך השחקן (player.html).
      </p>
      <div class="row">
        <div>
          <label for="playerImageUrl">כתובת תמונה (URL)</label>
          <input id="playerImageUrl" type="text" placeholder="/player-banner.png" />
        </div>
        <div>
          <label for="playerLinkUrl">קישור בלחיצה</label>
          <input id="playerLinkUrl" type="text" placeholder="https://example.com" />
        </div>
      </div>
      <div class="preview">
        תצוגה מקדימה:
        <img id="playerPreview" src="" alt="" style="display:none;" />
      </div>
    </div>
  </div>

  <script>
    const adminCodeInput = document.getElementById("adminCode");
    const saveBtn = document.getElementById("saveBtn");
    const saveStatus = document.getElementById("saveStatus");

    const logoImageUrlInput = document.getElementById("logoImageUrl");
    const logoAltTextInput = document.getElementById("logoAltText");
    const logoPreview = document.getElementById("logoPreview");

    const indexImageUrlInput = document.getElementById("indexImageUrl");
    const indexLinkUrlInput = document.getElementById("indexLinkUrl");
    const indexPreview = document.getElementById("indexPreview");

    const hostImageUrlInput = document.getElementById("hostImageUrl");
    const hostLinkUrlInput = document.getElementById("hostLinkUrl");
    const hostPreview = document.getElementById("hostPreview");

    const playerImageUrlInput = document.getElementById("playerImageUrl");
    const playerLinkUrlInput = document.getElementById("playerLinkUrl");
    const playerPreview = document.getElementById("playerPreview");

    function setPreview(imgElement, url) {
      if (!imgElement) return;
      if (url && url.trim()) {
        imgElement.src = url.trim();
        imgElement.style.display = "block";
      } else {
        imgElement.style.display = "none";
      }
    }

    // טעינת הגדרות נוכחיות
    fetch("/api/banners")
      .then(res => res.json())
      .then(data => {
        if (!data) return;

        if (data.logo) {
          logoImageUrlInput.value = data.logo.imageUrl || "";
          logoAltTextInput.value = data.logo.altText || "";
          setPreview(logoPreview, data.logo.imageUrl);
        }

        if (data.index) {
          indexImageUrlInput.value = data.index.imageUrl || "";
          indexLinkUrlInput.value = data.index.linkUrl || "";
          setPreview(indexPreview, data.index.imageUrl);
        }

        if (data.host) {
          hostImageUrlInput.value = data.host.imageUrl || "";
          hostLinkUrlInput.value = data.host.linkUrl || "";
          setPreview(hostPreview, data.host.imageUrl);
        }

        if (data.player) {
          playerImageUrlInput.value = data.player.imageUrl || "";
          playerLinkUrlInput.value = data.player.linkUrl || "";
          setPreview(playerPreview, data.player.imageUrl);
        }
      })
      .catch(() => {});

    // תצוגה מקדימה תוך כדי הקלדה
    logoImageUrlInput.addEventListener("input", () => setPreview(logoPreview, logoImageUrlInput.value));
    indexImageUrlInput.addEventListener("input", () => setPreview(indexPreview, indexImageUrlInput.value));
    hostImageUrlInput.addEventListener("input", () => setPreview(hostPreview, hostImageUrlInput.value));
    playerImageUrlInput.addEventListener("input", () => setPreview(playerPreview, playerImageUrlInput.value));

    // שמירת הגדרות
    saveBtn.addEventListener("click", () => {
      saveStatus.textContent = "";
      saveStatus.className = "status";

      const adminCode = adminCodeInput.value.trim();
      if (!adminCode) {
        saveStatus.textContent = "חסר קוד מנהל.";
        saveStatus.classList.add("err");
        return;
      }

      const payload = {
        adminCode,
        logo: {
          imageUrl: logoImageUrlInput.value.trim(),
          altText: logoAltTextInput.value.trim()
        },
        index: {
          imageUrl: indexImageUrlInput.value.trim(),
          linkUrl: indexLinkUrlInput.value.trim()
        },
        host: {
          imageUrl: hostImageUrlInput.value.trim(),
          linkUrl: hostLinkUrlInput.value.trim()
        },
        player: {
          imageUrl: playerImageUrlInput.value.trim(),
          linkUrl: playerLinkUrlInput.value.trim()
        }
      };

      fetch("/api/admin/banners", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      })
        .then(res => res.json())
        .then(data => {
          if (!data || !data.ok) {
            throw new Error((data && data.error) || "שגיאה");
          }
          saveStatus.textContent = "ההגדרות נשמרו בהצלחה.";
          saveStatus.classList.add("ok");
        })
        .catch(err => {
          console.error(err);
          saveStatus.textContent = "שגיאה בשמירה. בדוק את קוד המנהל ונסה שוב.";
          saveStatus.classList.add("err");
        });
    });
  </script>
</body>
</html>
