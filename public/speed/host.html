<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>× ×™×”×•×œ ×¡×¤×™×“ ×× ×™×”</title>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        :root { --bg: #1a1a2e; --card: #fff; --primary: #F84779; }
        body { margin: 0; background: radial-gradient(circle, #2B1E4A, #1a1a2e); font-family: "Varela Round", sans-serif; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        .nav { background: rgba(0,0,0,0.4); padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; color: white; }
        .tabs { display: flex; gap: 10px; background: rgba(255,255,255,0.1); padding: 5px; border-radius: 30px; }
        .tab-btn { background: none; border: none; color: #ccc; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; font-family: inherit; }
        .tab-btn.active { background: var(--primary); color: white; }
        .home-btn, .help-btn { background: rgba(255,255,255,0.2); border: none; color: white; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; margin-right: 5px; }
        .content { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; align-items: center; }
        .card { background: var(--card); padding: 25px; border-radius: 20px; width: 100%; max-width: 900px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); margin-bottom: 20px; }
        h2 { margin-top: 0; color: #2B1E4A; }
        input, select { width: 100%; padding: 12px; margin: 5px 0 15px; border-radius: 10px; border: 1px solid #ddd; box-sizing: border-box; font-size: 1rem; }
        .btn-main { width: 100%; padding: 15px; border-radius: 12px; border: none; background: linear-gradient(135deg, var(--primary), #ff8e53); color: white; font-weight: bold; font-size: 1.1rem; cursor: pointer; }
        .info-bar { display: flex; justify-content: space-between; align-items: center; width: 100%; max-width: 900px; margin-bottom: 20px; color: white; }
        .code { font-size: 2.5rem; font-weight: 900; color: #FFD700; letter-spacing: 5px; }
        .teams-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; width: 100%; }
        .team-card { background: white; padding: 15px; border-radius: 15px; border-top: 5px solid #ccc; position: relative; }
        .team-words { height: 100px; overflow-y: auto; background: #f5f5f5; border-radius: 10px; padding: 5px; margin-top: 10px; display: flex; flex-wrap: wrap; gap: 5px; align-content: flex-start; }
        .word-badge { background: #ddd; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; }
        .score-badge { position: absolute; top: 10px; left: 10px; font-size: 1.5rem; font-weight: bold; color: var(--primary); }
        .wa-link { display: inline-flex; align-items: center; gap: 5px; background: #25D366; color: white; padding: 5px 12px; border-radius: 20px; text-decoration: none; font-size: 0.85rem; font-weight: bold; margin-top: 5px; }
        iframe { width: 100%; height: 100%; border: none; border-radius: 15px; background: #2B1E4A; }
        .hidden { display: none !important; }
        .game-controls { display: flex; gap: 10px; align-items: center; }
        .btn-ctrl { background: #2ecc71; color: white; border: none; padding: 10px 20px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1.1rem; box-shadow: 0 4px 0 #27ae60; }
        .btn-ctrl:active { transform: translateY(2px); box-shadow: none; }
        .timer { font-size: 1.5rem; font-weight: bold; font-variant-numeric: tabular-nums; background: rgba(0,0,0,0.3); padding: 5px 10px; border-radius: 8px; }
    </style>
</head>
<body>

    <div class="nav">
        <div style="display:flex; gap:5px; align-items:center;">
            <button class="home-btn" onclick="location.href='../index.html'" title="×‘×™×ª"><i class="ph-bold ph-house"></i></button>
            <button class="help-btn" onclick="window.open('../instructions.html', '_blank')" title="×”×•×¨××•×ª"><i class="ph-bold ph-question"></i></button>
            <div style="font-weight:bold; font-size:1.2rem;">âš¡ ×¡×¤×™×“</div>
        </div>
        
        <div class="game-controls hidden" id="gameControls">
            <div class="timer" id="dTimer">00:00</div>
            <button class="btn-ctrl" onclick="start()">â–¶ ×”×ª×—×œ</button>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="setTab('host')">ğŸ‘‘ × ×™×”×•×œ</button>
            <button class="tab-btn" onclick="setTab('player')">ğŸ® ×©×—×§×Ÿ</button>
        </div>
    </div>

    <div class="content">
        <!-- Host View -->
        <div id="view-host" style="width:100%; display:flex; flex-direction:column; align-items:center;">
            <div id="setup" class="card">
                <h2>×”×’×“×¨×•×ª ××©×—×§</h2>
                <label>×©× ×”×× ×”×œ</label><input type="text" id="hName" placeholder="×©×">
                <div style="display:flex; gap:10px;">
                    <div style="flex:1"><label>×§×‘×•×¦×•×ª</label><select id="hTeams"><option value="2">2</option><option value="3">3</option><option value="4">4</option></select></div>
                    <div style="flex:1"><label>×–××Ÿ</label><input type="number" id="hTime" value="60"></div>
                </div>
                <button class="btn-main" onclick="create()">×¤×ª×— ×—×“×¨</button>
            </div>

            <div id="dashboard" class="hidden" style="width:100%; display:flex; flex-direction:column; align-items:center;">
                <div class="info-bar">
                    <div><span style="opacity:0.7">×§×•×“:</span><div class="code" id="dCode">---</div></div>
                    <div style="background:rgba(255,255,255,0.1); padding:10px; border-radius:15px; display:flex; align-items:center; gap:10px;">
                        <span>×©×—×§ ×‘×¢×¦××š:</span>
                        <select id="joinTeamSelect" style="margin:0; width:120px; color:black;"></select>
                        <button onclick="joinAsPlayer()" style="background:#3498db; color:white; border:none; padding:8px 15px; border-radius:8px; cursor:pointer;">×›× ×¡</button>
                    </div>
                </div>
                <div id="teamsGrid" class="teams-grid"></div>
            </div>
        </div>

        <!-- Player View -->
        <div id="view-player" class="hidden" style="width:100%; height:100%;">
            <iframe id="playerFrame" src="about:blank"></iframe>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script>
        let socket;
        let gameCode = null;
        let hostName = '';

        // ×‘×“×™×§×” ×‘×˜×•×—×” ×œ-Socket.io
        try {
            if (typeof io !== 'undefined') {
                socket = io();
            } else {
                throw new Error('Socket.io not loaded');
            }
        } catch (e) {
            console.warn("Socket.io not found. Running UI in Mock mode.");
            socket = { on: () => {}, emit: () => {} };
        }

        function setTab(t) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('view-host').classList.toggle('hidden', t !== 'host');
            document.getElementById('view-player').classList.toggle('hidden', t !== 'player');
        }

        function create() {
            hostName = document.getElementById('hName').value;
            if(!hostName) return alert('× × ×œ×”×–×™×Ÿ ×©×');
            socket.emit('speed:createGame', { hostName, teamCount: parseInt(document.getElementById('hTeams').value), duration: parseInt(document.getElementById('hTime').value) });
        }

        if (typeof io !== 'undefined') {
            socket.on('speed:gameCreated', ({ gameCode: code, teams }) => {
                gameCode = code;
                document.getElementById('setup').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                document.getElementById('gameControls').classList.remove('hidden');
                document.getElementById('dCode').innerText = code;
                updateTeams(teams);
            });

            socket.on('speed:hostFullUpdate', ({ teams, state, timeLeft }) => {
                updateTeams(teams);
                if(state === 'playing') document.getElementById('dTimer').innerText = timeLeft;
            });

            socket.on('speed:playerJoined', ({teams}) => updateTeams(teams));
            socket.on('speed:roundEnd', () => alert('×”×¡×™×‘×•×‘ × ×’××¨!'));
        }

        function updateTeams(teams) {
            const grid = document.getElementById('teamsGrid');
            const select = document.getElementById('joinTeamSelect');
            grid.innerHTML = '';
            
            if(select.children.length === 0) {
                Object.values(teams).forEach(t => select.innerHTML += `<option value="${t.id}">${t.name}</option>`);
            }

            Object.values(teams).forEach(t => {
                const words = t.foundWords.map(w => `<span class="word-badge">${w}</span>`).join('');
                const players = t.players.map(p => p.name).join(', ');
                const link = `${window.location.origin}/speed/player.html?code=${gameCode}&teamId=${t.id}`;
                const waLink = `https://wa.me/?text=${encodeURIComponent('×‘×•××• ×œ×©×—×§ ×‘×§×‘×•×¦×” ×©×œ×™ ×‘×¡×¤×™×“-×× ×™×”! âš¡\n' + link)}`;

                grid.innerHTML += `
                    <div class="team-card" style="border-top-color:${t.color}">
                        <div style="margin-bottom:10px;">
                            <strong>${t.name}</strong>
                            <a href="${waLink}" target="_blank" class="wa-link">×•×•×¦××¤ ğŸ“²</a>
                        </div>
                        <div class="score-badge">${t.score}</div>
                        <div style="font-size:0.8rem; color:#666;">${players}</div>
                        <div class="team-words">${words}</div>
                    </div>
                `;
            });
        }

        function start() { socket.emit('speed:startGame', { code: gameCode }); }

        function joinAsPlayer() {
            const teamId = document.getElementById('joinTeamSelect').value;
            const src = `player.html?code=${gameCode}&name=${encodeURIComponent(hostName + ' (×)')}&teamId=${teamId}`;
            document.getElementById('playerFrame').src = src;
            setTab('player');
            document.querySelectorAll('.tab-btn')[1].classList.add('active');
            document.querySelectorAll('.tab-btn')[0].classList.remove('active');
        }
        
        setInterval(() => { if(gameCode) socket.emit('speed:getHostState', { code: gameCode }); }, 3000);
    </script>
</body>
</html>
