<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>××™×œ×× ×™×” - × ×™×”×•×œ ××©×—×§</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">

  <style>
    :root { font-size: 16px; }
    * { box-sizing: border-box; font-family: "Varela Round", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; -webkit-tap-highlight-color: transparent; }
    body { margin: 0; padding: 0; background: #FFF8EA; color: #2B1E4A; min-height: 100vh; font-size: 1rem; position: relative; overflow-x: hidden; }
    body::before, body::after { content: ""; position: fixed; width: 300px; height: 300px; border-radius: 50%; z-index: -1; filter: blur(40px); opacity: 0.15; }
    body::before { top: -100px; left: -100px; background: radial-gradient(circle, #F84779 0%, transparent 70%); }
    body::after { bottom: -100px; right: -100px; background: radial-gradient(circle, #15C4C1 0%, transparent 70%); }

    .app { max-width: 1024px; width: 100%; padding: 20px 14px 80px; margin: 0 auto; }
    .card { background: #FFFFFF; border-radius: 26px; padding: 22px 18px; box-shadow: 0 18px 40px rgba(0, 0, 0, 0.06); border: 1px solid rgba(43, 30, 74, 0.06); margin-bottom: 16px; }
    h1, h2, h3 { margin-top: 0; color:#2B1E4A; }
    label { display: block; margin-bottom: 5px; font-size: 0.9rem; color: #6B618F; font-weight:600; }
    input, select { width: 100%; padding: 12px; border-radius: 14px; border: 2px solid rgba(43, 30, 74, 0.15); background: #FFFDF7; color: #2B1E4A; font-size: 1rem; transition:all 0.2s; }
    input::placeholder, select::placeholder { color: #B0A6CC; }
    input:focus, select:focus { outline: none; border-color: #F84779; background:#fff; box-shadow: 0 4px 12px rgba(248, 71, 121, 0.15); }
    .row { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 12px; }
    .row > div { flex: 1 1 200px; }
    .btn { display: inline-flex; align-items: center; justify-content: center; padding: 12px 20px; border-radius: 16px; border: none; cursor: pointer; font-size: 1rem; font-weight: 700; transition: all 0.2s ease; white-space: nowrap; letter-spacing:0.02em; }
    .btn:active { transform: scale(0.98); }
    .btn-primary { background: linear-gradient(135deg, #F84779, #FF8566); color: #ffffff; box-shadow: 0 8px 20px rgba(248, 71, 121, 0.25); }
    .btn-success { background: linear-gradient(135deg, #15C4C1, #42E695); color: #ffffff; box-shadow: 0 8px 20px rgba(21, 196, 193, 0.25); }
    .btn-danger { background: rgba(239, 68, 68, 0.1); color: #EF4444; border: 2px solid currentColor; }
    /* <--- ×ª×™×§×•×Ÿ ×ª×§×œ×” 1: ×›×¤×ª×•×¨ ×•×•××˜×¡××¤ ×™×¨×•×§ */
    .btn-whatsapp { background: linear-gradient(135deg, #25D366, #128C7E); color: #ffffff; box-shadow: 0 10px 24px rgba(37, 211, 102, 0.35); }
    .btn-whatsapp:hover { transform: translateY(-1px); box-shadow: 0 14px 32px rgba(37, 211, 102, 0.5); }

    .btn-ghost { background: transparent; border: 2px solid rgba(107, 97, 143, 0.3); color: #6B618F; }
    .btn-small { padding: 8px 14px; font-size: 0.85rem; border-radius:12px; }
    .btn[disabled] { opacity: 0.6; cursor: not-allowed; box-shadow: none; transform: none; filter:grayscale(0.5); }

    .chip { display: inline-flex; align-items: center; padding: 6px 12px; border-radius: 999px; background: rgba(248, 71, 121, 0.1); color: #F84779; font-size: 0.85rem; font-weight: 600; margin-bottom: 8px; gap:6px; }
    .status-text { font-size: 0.95rem; color: #6B618F; line-height:1.5; }
    .logo-small { height: 54px; width: auto; border-radius: 14px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    .hidden { display: none !important; }
    #roundTimer { margin-top: 8px; font-size: 2rem; font-weight: 800; color: #F84779; font-variant-numeric: tabular-nums; }

    .page-header { display: flex; justify-content: space-between; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom:16px; }
    .page-header-main { display: flex; align-items: center; gap: 12px; }
    .top-tabs { display: inline-flex; border-radius: 16px; background: #FFFDF7; border: 2px solid rgba(43, 30, 74, 0.1); padding:4px; }
    .top-tabs button { border: none; padding: 8px 16px; font-size: 0.9rem; cursor: pointer; background: transparent; color: #6B618F; font-weight: 700; border-radius: 12px; transition:all 0.2s; }
    .top-tabs button.active { background: #E2DCEF; color: #2B1E4A; }

    .player-pill { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 12px; background: #F8F7FF; border: 1px solid rgba(180, 169, 214, 0.4); margin: 4px; font-size: 0.9rem; color: #433362; font-weight:600; }
    .remove-player-btn { border: none; background: rgba(239, 68, 68, 0.1); color: #EF4444; width:24px; height:24px; border-radius:50%; cursor: pointer; display:flex; align-items:center; justify-content:center; font-size:1rem; transition:all 0.2s; }
    .remove-player-btn:hover { background: #EF4444; color:white; }
    .team-row { display: flex; justify-content: space-between; padding: 10px 12px; background:#FFFDF7; border-radius:12px; margin-bottom:8px; font-weight:600; }

    /* --- ×¡×’× ×•× ×•×ª ××¦×‘ ×©×—×§×Ÿ ×©×œ ×”×× ×”×œ (×”×•×ª×× ×œ-player.html) --- */
    #hostPresenterSection { background: linear-gradient(135deg, #FFFDF7, #FFF); border: 2px dashed #E2DCEF; border-radius: 20px; padding: 24px 16px; text-align: center; margin-top: 20px; }
    #hostPresenterWord { font-size: 2.8rem; font-weight: 800; color: #2B1E4A; margin: 0 0 8px; line-height: 1.1; }
    #hostPresenterCategory { display: inline-block; background: #E2DCEF; color: #6B618F; padding: 4px 12px; border-radius: 20px; font-size: 0.9rem; margin-bottom: 20px; }
    .host-presenter-actions { display: flex; gap: 12px; }
    .host-presenter-actions .btn { flex: 1; padding: 16px; font-size: 1.1rem; }
    #hostPlayerBigTimer { font-size: 3.5rem; font-weight: 800; color: #F84779; text-align: center; line-height: 1; margin: 16px 0; font-variant-numeric: tabular-nums; }

    /* --- ×›×¤×ª×•×¨×™× ×¦×¤×™× ×œ××¢×‘×¨ ×‘×™×Ÿ ××¦×‘×™× --- */
    #floating-nav { position: fixed; bottom: 24px; left: 24px; display:flex; flex-direction:column; gap:12px; z-index:90; }
    .floating-nav-btn { padding: 12px 20px; border-radius: 50px; font-weight: 700; box-shadow: 0 10px 25px rgba(0,0,0,0.2); transition:all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
    .floating-nav-btn:hover { transform: scale(1.05) translateY(-2px); box-shadow: 0 15px 35px rgba(0,0,0,0.3); }

    /* --- <--- ×ª×•×¡×¤×ª: ×¢×™×¦×•×‘ ×œ×¤×× ×œ × ×™×”×•×œ ×¦×£ (×›××• ×‘-player.html) --- */
    #adminFab { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); background: #2B1E4A; color: #FFD76F; padding: 12px 24px; border-radius: 50px; font-weight: 700; box-shadow: 0 10px 25px rgba(43, 30, 74, 0.3); cursor: pointer; z-index: 100; display: flex; align-items: center; gap: 8px; transition: all 0.2s; }
    #adminFab:active { transform: translateX(-50%) scale(0.95); }
    #adminFloatingPanel { position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 500px; background: #FFFFFF; border-radius: 24px; padding: 20px; box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2); z-index: 99; border: 2px solid #E2DCEF; }
    .admin-panel-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; }
    .close-panel-btn { background:none; border:none; font-size:1.8rem; color:#6B618F; cursor:pointer; padding:4px; line-height:1; }

    /* --- <--- ×ª×•×¡×¤×ª: ×¢×™×¦×•×‘ ×œ××•×“×œ ×¤×•×¤××¤ (×›××• ×‘-player.html) --- */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(43, 30, 74, 0.7); backdrop-filter: blur(6px); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s ease; }
    .modal-overlay.active { opacity: 1; visibility: visible; }
    .modal-box { background: #fff; width: 85%; max-width: 420px; border-radius: 28px; padding: 32px 24px; text-align: center; box-shadow: 0 30px 60px rgba(0,0,0,0.3); transform: translateY(40px); transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }
    .modal-overlay.active .modal-box { transform: translateY(0); }
    .modal-title { font-size: 1.6rem; font-weight: 800; margin-bottom: 16px; color: #2B1E4A; }
    .modal-content { font-size: 1.1rem; color: #6B618F; margin-bottom: 28px; line-height: 1.6; }

    @media (max-width: 768px) { .app { padding: 16px 12px 90px; } .card { padding: 20px 16px; } h1 { font-size: 1.6rem; } .btn { padding: 12px 16px; } #roundTimer { font-size: 1.8rem; } }
  </style>
</head>
<body>
  <div class="app">
    <div class="page-header">
      <div class="page-header-main">
        <img id="host-logo" class="logo-small hidden" alt="×œ×•×’×•" />
        <div>
          <div class="chip">××™×œ×× ×™×” Â· × ×™×”×•×œ ××©×—×§ ğŸ‘‘</div>
          <h1 style="margin:4px 0 0;">×× ×”×œ ×”××©×—×§</h1>
        </div>
      </div>
      <div style="display:flex; flex-direction:column; gap:8px; align-items:flex-end;">
        <div class="top-tabs">
          <button id="tabHost" class="active" type="button">ğŸ‘‘ × ×™×”×•×œ</button>
          <button id="tabPlayer" type="button">ğŸ® ×× ×™ ×›×©×—×§×Ÿ</button>
        </div>
        <div style="display:flex; gap:8px;">
          <button class="btn btn-ghost btn-small" onclick="location.href='instructions.html'">â” ×”×•×¨××•×ª</button>
          <button class="btn btn-ghost btn-small" onclick="location.href='home.html'">ğŸ  ×‘×™×ª</button>
        </div>
      </div>
    </div>

    <div id="hostMode">
      <div class="card" id="createGameCard">
        <h3>×™×¦×™×¨×ª ××©×—×§ ×—×“×©</h3>
        <div class="row">
          <div style="flex:2;">
            <label for="hostName">×©× ×”×× ×”×œ (×™×•×¤×™×¢ ×‘××©×—×§)</label>
            <input id="hostName" type="text" placeholder="×œ×“×•×’××”: ×”×××¡×˜×¨" />
          </div>
          <div>
            <label for="numTeams">××¡×¤×¨ ×§×‘×•×¦×•×ª</label>
            <select id="numTeams">
              <option value="2">2 ×§×‘×•×¦×•×ª</option>
              <option value="3">3 ×§×‘×•×¦×•×ª</option>
              <option value="4">4 ×§×‘×•×¦×•×ª</option>
              <option value="5">5 ×§×‘×•×¦×•×ª</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div>
            <label for="targetScore">×™×¢×“ × ×§×•×“×•×ª</label>
            <input id="targetScore" type="number" min="10" max="300" value="50" />
          </div>
          <div>
            <label for="roundSeconds">×©× ×™×•×ª ×œ×¡×™×‘×•×‘</label>
            <input id="roundSeconds" type="number" min="20" max="300" value="60" />
          </div>
        </div>
        <div style="margin-top:16px;">
           <label style="margin-bottom:8px;">×©××•×ª ×”×§×‘×•×¦×•×ª</label>
           <div class="row" style="gap:10px;">
             <input id="teamNameA" type="text" placeholder="×§×‘×•×¦×” A (×—×•×‘×”)" style="flex:1;" />
             <input id="teamNameB" type="text" placeholder="×§×‘×•×¦×” B (×—×•×‘×”)" style="flex:1;" />
           </div>
           <div class="row" style="gap:10px; margin-top:10px;">
             <input id="teamNameC" type="text" placeholder="×§×‘×•×¦×” C (××•×¤×¦×™×•× ×œ×™)" style="flex:1;" />
             <input id="teamNameD" type="text" placeholder="×§×‘×•×¦×” D (××•×¤×¦×™×•× ×œ×™)" style="flex:1;" />
             <input id="teamNameE" type="text" placeholder="×§×‘×•×¦×” E (××•×¤×¦×™×•× ×œ×™)" style="flex:1;" />
           </div>
        </div>
        <div style="margin-top:16px;">
          <label style="display:flex; justify-content:space-between; align-items:center;">
              <span>×§×˜×’×•×¨×™×•×ª ××™×œ×™×</span>
              <label style="font-size:0.9rem; display:flex; align-items:center; gap:6px; margin:0; cursor:pointer;">
                  <input type="checkbox" id="catSelectAll" checked /> ×‘×—×¨ ×”×›×œ
              </label>
          </label>
          <div style="display:flex; flex-wrap:wrap; gap:8px; margin-top:8px;">
            <label class="chip" style="background:#FFFDF7; border:1px solid #E2DCEF; color:#6B618F; cursor:pointer;"><input type="checkbox" class="cat-checkbox" value="general" checked /> ×›×œ×œ×™</label>
            <label class="chip" style="background:#FFFDF7; border:1px solid #E2DCEF; color:#6B618F; cursor:pointer;"><input type="checkbox" class="cat-checkbox" value="family" checked /> ××©×¤×—×”</label>
            <label class="chip" style="background:#FFFDF7; border:1px solid #E2DCEF; color:#6B618F; cursor:pointer;"><input type="checkbox" class="cat-checkbox" value="food" checked /> ××•×›×œ</label>
            <label class="chip" style="background:#FFFDF7; border:1px solid #E2DCEF; color:#6B618F; cursor:pointer;"><input type="checkbox" class="cat-checkbox" value="work" checked /> ×¢×‘×•×“×”</label>
            <label class="chip" style="background:#FFFDF7; border:1px solid #E2DCEF; color:#6B618F; cursor:pointer;"><input type="checkbox" class="cat-checkbox" value="hard" checked /> ×§×©×”</label>
            <label class="chip" style="background:#FFFDF7; border:1px solid #E2DCEF; color:#6B618F; cursor:pointer;"><input type="checkbox" class="cat-checkbox" value="sports" checked /> ×¡×¤×•×¨×˜</label>
            <label class="chip" style="background:#FFFDF7; border:1px solid #E2DCEF; color:#6B618F; cursor:pointer;"><input type="checkbox" class="cat-checkbox" value="technology" checked /> ×˜×›× ×•×œ×•×’×™×”</label>
            <label class="chip" style="background:#FFFDF7; border:1px solid #E2DCEF; color:#6B618F; cursor:pointer;"><input type="checkbox" class="cat-checkbox" value="travel" checked /> ×˜×™×•×œ×™×</label>
            <label class="chip" style="background:#FFFDF7; border:1px solid #E2DCEF; color:#6B618F; cursor:pointer;"><input type="checkbox" class="cat-checkbox" value="school" checked /> ×œ×™××•×“×™×</label>
            <label class="chip" style="background:#FFFDF7; border:1px solid #E2DCEF; color:#6B618F; cursor:pointer;"><input type="checkbox" class="cat-checkbox" value="entertainment" checked /> ×‘×™×“×•×¨</label>
            <label class="chip" style="background:#FFFDF7; border:1px solid #E2DCEF; color:#6B618F; cursor:pointer;"><input type="checkbox" class="cat-checkbox" value="music" checked /> ××•×–×™×§×”</label>
            <label class="chip" style="background:#FFFDF7; border:1px solid #E2DCEF; color:#6B618F; cursor:pointer;"><input type="checkbox" class="cat-checkbox" value="nature" checked /> ×˜×‘×¢</label>
            <label class="chip" style="background:#FFFDF7; border:1px solid #E2DCEF; color:#6B618F; cursor:pointer;"><input type="checkbox" class="cat-checkbox" value="holidays" checked /> ×—×’×™×</label>
            <label class="chip" style="background:#FFFDF7; border:1px solid #E2DCEF; color:#6B618F; cursor:pointer;"><input type="checkbox" class="cat-checkbox" value="animals" checked /> ×‘×¢"×—</label>
            <label class="chip" style="background:#FFFDF7; border:1px solid #E2DCEF; color:#6B618F; cursor:pointer;"><input type="checkbox" class="cat-checkbox" value="objects" checked /> ×—×¤×¦×™×</label>
          </div>
        </div>

        <div style="margin-top:20px; display:flex; gap:12px; align-items:center;">
            <button id="createGameBtn" class="btn btn-primary" style="flex:2; font-size:1.1rem; padding:14px;">âœ¨ ×¦×•×¨ ××©×—×§ ×•×”×ª×—×œ</button>
            <button id="endGameBtn" class="btn btn-danger" style="flex:1;" disabled>×¡×’×•×¨ ××©×—×§</button>
        </div>
        <div id="hostStatus" class="status-text" style="margin-top:12px; text-align:center; font-weight:600;"></div>
      </div>

      <div id="activeGameControls" class="hidden">
          <div class="card" style="background:#F8F7FF; border-color:#A18CCF;">
            <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:12px;">
                <div>
                    <h3 style="margin-bottom:4px;">×§×•×“ ×”××©×—×§: <span id="gameCodeDisplay" style="font-family:monospace; font-size:1.4rem; color:#F84779; letter-spacing:1px;"></span></h3>
                    <div class="status-text">×©×ª×£ ××ª ×”×§×•×“ ××• ×©×œ×— ×”×–×× ×” ×™×©×™×¨×”</div>
                </div>
                <div style="display:flex; gap:8px; align-items:flex-end;">
                    <div style="flex:1;">
                        <select id="inviteTeamSelect" style="padding:8px; font-size:0.9rem;"><option value="">×‘×—×¨ ×§×‘×•×¦×” ×œ×”×–×× ×”...</option></select>
                    </div>
                    <button id="whatsappInviteBtn" class="btn btn-whatsapp" style="padding:8px 16px;">ğŸ“² ×”×–××Ÿ ×‘×•×•×¦××¤</button>
                </div>
            </div>
          </div>

          <div class="card">
            <h3>×©×œ×™×˜×” ×‘×¡×™×‘×•×‘</h3>
            <div style="background:#FFFDF7; padding:16px; border-radius:16px; text-align:center; margin-bottom:16px; border:2px dashed #E2DCEF;">
                <div id="roundStatus" class="status-text" style="font-size:1.1rem; font-weight:600;">××™×Ÿ ×¡×™×‘×•×‘ ×¤×¢×™×œ ×›×¨×’×¢</div>
                <div id="roundTimer">--:--</div>
            </div>

            <div class="row">
              <div>
                <label for="roundTeamSelect">×§×‘×•×¦×” ×œ×¡×™×‘×•×‘ ×”×‘×</label>
                <select id="roundTeamSelect"><option value="">×‘×—×¨ ×§×‘×•×¦×”...</option></select>
              </div>
              <div>
                <label for="explainerSelect">××¡×‘×™×¨/×” (××•×¤×¦×™×•× ×œ×™)</label>
                <select id="explainerSelect"><option value="">×‘×—×™×¨×” ××•×˜×•××˜×™×ª ×¢"×™ ×”××¢×¨×›×ª</option></select>
              </div>
              <div>
                 <label for="roundSecondsInline">×©× ×™×•×ª ×œ×¡×™×‘×•×‘ ×–×”</label>
                 <input id="roundSecondsInline" type="number" min="10" max="300" value="60" style="text-align:center;" />
              </div>
            </div>
            <div style="display:flex; gap:12px; margin-top:16px;">
              <button id="startRoundBtn" class="btn btn-success" style="flex:2; font-size:1.1rem;">â–¶ ×”×ª×—×œ ×¡×™×‘×•×‘</button>
              <button id="stopRoundBtn" class="btn btn-danger" style="flex:1;" disabled>â¹ ×¡×™×™× ×¡×™×‘×•×‘</button>
            </div>
          </div>

          <div class="row">
              <div class="card" style="flex:1;">
                <h3>×˜×‘×œ×ª × ×™×§×•×“ <span id="scoreTargetDisplay" style="font-size:0.9rem; font-weight:400;"></span></h3>
                <div id="scoreboard"></div>
              </div>
              <div class="card" style="flex:1.5;">
                <h3>×©×—×§× ×™× ××—×•×‘×¨×™×</h3>
                <div id="playersByTeam"></div>
              </div>
          </div>
          <div id="host-banner-slot" style="margin-top:16px; text-align:center;"></div>
      </div>
    </div>

    <div id="playerMode" class="hidden">
      <div class="card" id="hostPlayerJoinCard">
        <h2>×”×¦×˜×¨×¤×•×ª ×œ××©×—×§ ×›×©×—×§×Ÿ</h2>
        <p class="status-text" style="margin-bottom:16px;">×›×× ×”×œ, ××ª×” ×™×›×•×œ ×œ×”×¦×˜×¨×£ ×’× ×›×©×—×§×Ÿ ×‘××—×ª ×”×§×‘×•×¦×•×ª ×•×œ×©×—×§ ×™×—×“ ×¢× ×›×•×œ×. ×ª×•×›×œ ×œ×¢×‘×•×¨ ×‘×—×–×¨×” ×œ××¡×š ×”× ×™×”×•×œ ×‘×›×œ ×¨×’×¢.</p>
        <div class="row">
          <div>
            <label for="hostPlayerName">×”×©× ×©×œ×™ ×›×©×—×§×Ÿ</label>
            <input id="hostPlayerName" type="text" />
          </div>
          <div>
            <label for="hostPlayerTeamSelect">×‘×—×¨ ×§×‘×•×¦×”</label>
            <select id="hostPlayerTeamSelect"><option value="">×˜×•×¢×Ÿ ×§×‘×•×¦×•×ª...</option></select>
          </div>
        </div>
        <button id="openPlayerViewBtn" class="btn btn-primary" style="margin-top:16px; width:100%; font-size:1.1rem;">ğŸš€ ×”×¦×˜×¨×£ ×•×©×—×§!</button>
      </div>

      <div class="card hidden" id="hostPlayerGameCard" style="background:#FFF8EA; border:none; box-shadow:none; padding:0;">
         <div style="background:#fff; padding:20px; border-radius:24px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); border:1px solid rgba(43,30,74,0.04);">
             <div style="background:#F8F7FF; padding:12px 16px; border-radius:14px; margin-bottom:12px; font-weight:600; color:#433362;" id="hostPlayerGameInfo"></div>
             <div class="row">
                 <div style="background:#F8F7FF; padding:12px 16px; border-radius:14px; flex:1;">
                   <div style="font-size:0.85rem; color:#A18CCF; margin-bottom:4px; font-weight:600;">×”×§×‘×•×¦×” ×©×œ×™</div>
                   <div id="hostPlayerTeamName" style="font-size:1.1rem; color:#433362; font-weight:700;"></div>
                 </div>
                 <div style="background:#F8F7FF; padding:12px 16px; border-radius:14px; flex:1.5;">
                   <div style="font-size:0.85rem; color:#A18CCF; margin-bottom:4px; font-weight:600;">×—×‘×¨×™ ×”×§×‘×•×¦×”</div>
                   <div id="hostPlayerTeamPlayers" style="font-size:0.95rem; color:#433362;"></div>
                 </div>
             </div>

             <div style="text-align:center; padding: 24px 0;">
                 <div id="hostRoundStatusPlayer" class="status-text" style="font-weight:700; font-size:1.2rem; color:#2B1E4A;"></div>
                 <div id="hostPlayerBigTimer">--:--</div>
             </div>

             <div id="hostPresenterSection" class="hidden">
               <div style="font-size: 1.1rem; color: #F84779; font-weight: 700; margin-bottom: 12px;">××ª×” ×”××¡×‘×™×¨! ğŸ—£ï¸</div>
               <div id="hostPresenterWord">...</div>
               <div id="hostPresenterCategory">×˜×•×¢×Ÿ...</div>
               <div class="host-presenter-actions">
                 <button id="hostBtnSkip" class="btn btn-primary" style="background: #FFB4CB; color:#A11C4B; box-shadow:none;">â­ ×“×œ×’ (-1)</button>
                 <button id="hostBtnCorrect" class="btn btn-success" style="flex:1.5; font-size:1.2rem;">âœ… × ×›×•×Ÿ! (+1)</button>
               </div>
             </div>

             <hr style="border:none; border-top:2px dashed #E2DCEF; margin: 24px 0;" />
             <h3>×˜×‘×œ×ª × ×™×§×•×“</h3>
             <div id="hostPlayerScoreboard" style="background:#F8F7FF; padding:16px; border-radius:14px; font-family:monospace; white-space:pre-wrap; font-size:1.1rem;"></div>
         </div>
      </div>
    </div>
  </div>

  <div id="floating-nav" class="hidden">
      <button id="floatingToPlayer" class="btn btn-primary floating-nav-btn hidden">ğŸ® ××¢×‘×¨ ×œ××©×—×§</button>
      <button id="floatingToHost" class="btn btn-primary floating-nav-btn hidden" style="background: linear-gradient(135deg, #2B1E4A, #433362);">ğŸ‘‘ ××¢×‘×¨ ×œ× ×™×”×•×œ</button>
  </div>

  <div id="adminFab" class="hidden"><span>ğŸ‘‘</span> × ×™×”×•×œ ×¡×‘×‘</div>
  <div id="adminFloatingPanel" class="hidden">
      <div class="admin-panel-header">
          <h3 style="margin:0;">× ×™×”×•×œ ×¡×‘×‘ ××”×™×¨</h3>
          <button class="close-panel-btn" id="closeAdminPanel">Ã—</button>
      </div>
      <div class="row" style="margin-bottom:16px;">
          <div style="flex:2;">
             <label for="floatTeamSelect">×§×‘×•×¦×”</label>
             <select id="floatTeamSelect"></select>
          </div>
          <div style="flex:1;">
             <label for="floatSeconds">×©× ×™×•×ª</label>
             <input type="number" id="floatSeconds" value="60" min="10" max="300" style="text-align:center;">
          </div>
      </div>
      <div style="display:flex; gap:12px;">
          <button id="floatStartBtn" class="btn btn-success" style="flex:2; font-size:1.1rem;">â–¶ ×”×ª×—×œ</button>
          <button id="floatStopBtn" class="btn btn-danger" style="flex:1;" disabled>â¹ ×¡×™×™×</button>
      </div>
  </div>

  <div class="modal-overlay" id="customModal">
      <div class="modal-box">
          <div class="modal-title" id="modalTitle"></div>
          <div class="modal-content" id="modalContent"></div>
          <button class="btn btn-primary" id="modalCloseBtn" style="width:100%; font-size:1.1rem;">×¡×’×•×¨</button>
      </div>
  </div>


  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const LS_HOST_GAME_KEY = "mil_hostGameCode";
    const LS_HOST_PLAYER_DATA = "mil_hostPlayerData";

    let currentGameCode = null;
    let lastGameState = null;
    let roundTimerInterval = null;

    // ××œ×× ×˜×™× - ×›×œ×œ×™
    const hostLogoEl = document.getElementById("host-logo");
    const tabHost = document.getElementById("tabHost");
    const tabPlayer = document.getElementById("tabPlayer");
    const hostMode = document.getElementById("hostMode");
    const playerMode = document.getElementById("playerMode");
    const floatingNav = document.getElementById("floating-nav");
    const floatingToPlayer = document.getElementById("floatingToPlayer");
    const floatingToHost = document.getElementById("floatingToHost");

    // ××œ×× ×˜×™× - ××¦×‘ ×× ×”×œ
    const createGameCard = document.getElementById("createGameCard");
    const activeGameControls = document.getElementById("activeGameControls");
    const hostNameInput = document.getElementById("hostName");
    const numTeamsSelect = document.getElementById("numTeams");
    const targetScoreInput = document.getElementById("targetScore");
    const roundSecondsInput = document.getElementById("roundSeconds");
    const teamNameInputs = { A: document.getElementById("teamNameA"), B: document.getElementById("teamNameB"), C: document.getElementById("teamNameC"), D: document.getElementById("teamNameD"), E: document.getElementById("teamNameE") };
    const catCheckboxes = document.querySelectorAll(".cat-checkbox");
    const selectAllCatsCheckbox = document.getElementById("catSelectAll");
    const createGameBtn = document.getElementById("createGameBtn");
    const endGameBtn = document.getElementById("endGameBtn");
    const hostStatus = document.getElementById("hostStatus");
    const gameCodeDisplay = document.getElementById("gameCodeDisplay");
    const inviteTeamSelect = document.getElementById("inviteTeamSelect");
    const whatsappInviteBtn = document.getElementById("whatsappInviteBtn");
    const roundStatusEl = document.getElementById("roundStatus");
    const roundTimerEl = document.getElementById("roundTimer");
    const roundTeamSelect = document.getElementById("roundTeamSelect");
    const explainerSelect = document.getElementById("explainerSelect");
    const roundSecondsInline = document.getElementById("roundSecondsInline");
    const startRoundBtn = document.getElementById("startRoundBtn");
    const stopRoundBtn = document.getElementById("stopRoundBtn");
    const scoreboardEl = document.getElementById("scoreboard");
    const scoreTargetDisplay = document.getElementById("scoreTargetDisplay");
    const playersByTeamEl = document.getElementById("playersByTeam");
    const hostBannerSlot = document.getElementById("host-banner-slot");

    // ××œ×× ×˜×™× - ××¦×‘ ×©×—×§×Ÿ-×× ×”×œ
    const hostPlayerJoinCard = document.getElementById("hostPlayerJoinCard");
    const hostPlayerGameCard = document.getElementById("hostPlayerGameCard");
    const hostPlayerNameInput = document.getElementById("hostPlayerName");
    const hostPlayerTeamSelect = document.getElementById("hostPlayerTeamSelect");
    const openPlayerViewBtn = document.getElementById("openPlayerViewBtn");
    const hostPlayerGameInfo = document.getElementById("hostPlayerGameInfo");
    const hostPlayerTeamNameEl = document.getElementById("hostPlayerTeamName");
    const hostPlayerTeamPlayersEl = document.getElementById("hostPlayerTeamPlayers");
    const hostRoundStatusPlayerEl = document.getElementById("hostRoundStatusPlayer");
    const hostPlayerBigTimerEl = document.getElementById("hostPlayerBigTimer");
    const hostPresenterSection = document.getElementById("hostPresenterSection");
    const hostPresenterWordEl = document.getElementById("hostPresenterWord");
    const hostPresenterCategoryEl = document.getElementById("hostPresenterCategory");
    const hostBtnCorrect = document.getElementById("hostBtnCorrect");
    const hostBtnSkip = document.getElementById("hostBtnSkip");
    const hostPlayerScoreboardEl = document.getElementById("hostPlayerScoreboard");

    // <--- ×ª×•×¡×¤×ª: ××œ×× ×˜×™× ×œ×¤×× ×œ × ×™×”×•×œ ×¦×£ ×•××•×“×œ
    const adminFab = document.getElementById("adminFab");
    const adminFloatingPanel = document.getElementById("adminFloatingPanel");
    const closeAdminPanelBtn = document.getElementById("closeAdminPanel");
    const floatTeamSelect = document.getElementById("floatTeamSelect");
    const floatSecondsInput = document.getElementById("floatSeconds");
    const floatStartBtn = document.getElementById("floatStartBtn");
    const floatStopBtn = document.getElementById("floatStopBtn");
    const customModal = document.getElementById("customModal");
    const modalTitle = document.getElementById("modalTitle");
    const modalContent = document.getElementById("modalContent");
    const modalCloseBtn = document.getElementById("modalCloseBtn");


    // State
    let isHostAlsoPlayer = false;
    let hostPlayerClientId = null;
    let hostPlayerTeamId = null;
    let hostCurrentWord = null;
    let hostLastRoundKey = null;
    let hostIsCurrentExplainer = false;


    // --- ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ---

    function formatTime(seconds) {
      const s = Math.max(0, Math.floor(seconds || 0));
      const m = Math.floor(s / 60).toString().padStart(2, "0");
      const ss = (s % 60).toString().padStart(2, "0");
      return m + ":" + ss;
    }

    // <--- ×ª×•×¡×¤×ª: ×¤×•× ×§×¦×™×” ×œ×”×¦×’×ª ×”××•×“×œ ×”××¢×•×¦×‘ (××—×œ×™×¤×” ××ª alert)
    function showModal(title, content) {
        modalTitle.textContent = title;
        modalContent.innerHTML = content;
        customModal.classList.add("active");
    }
    modalCloseBtn.addEventListener("click", () => { customModal.classList.remove("active"); });

    // --- ×œ×•×’×™×§×ª ×¤×× ×œ × ×™×”×•×œ ×¦×£ (×¢×‘×•×¨ ×˜××‘ ×©×—×§×Ÿ) ---
    adminFab.addEventListener("click", () => {
        adminFloatingPanel.classList.remove("hidden");
        adminFab.classList.add("hidden");
        populateFloatTeamSelect();
    });
    closeAdminPanelBtn.addEventListener("click", () => {
        adminFloatingPanel.classList.add("hidden");
        if (isHostAlsoPlayer && playerMode.classList.contains("hidden") === false) {
             adminFab.classList.remove("hidden");
        }
    });
    function populateFloatTeamSelect() {
        if (!lastGameState || !lastGameState.teams) return;
        floatTeamSelect.innerHTML = "";
        Object.entries(lastGameState.teams).forEach(([tid, team]) => {
            const opt = document.createElement("option");
            opt.value = tid;
            opt.textContent = team.name || tid;
            floatTeamSelect.appendChild(opt);
        });
        // ×‘×—×™×¨×ª ×”×§×‘×•×¦×” ×”×‘××” ××•×˜×•××˜×™×ª (××•×¤×¦×™×•× ×œ×™)
        if (lastGameState.currentRound && lastGameState.currentRound.teamId) {
             const teamIds = Object.keys(lastGameState.teams);
             const currentIdx = teamIds.indexOf(lastGameState.currentRound.teamId);
             const nextIdx = (currentIdx + 1) % teamIds.length;
             floatTeamSelect.value = teamIds[nextIdx];
        } else if (roundTeamSelect.value) {
             floatTeamSelect.value = roundTeamSelect.value;
        }
    }
    floatStartBtn.addEventListener("click", () => {
        if(!currentGameCode) return;
        socket.emit("startRound", {
            gameCode: currentGameCode,
            teamId: floatTeamSelect.value,
            roundSeconds: parseInt(floatSecondsInput.value) || 60
        });
        adminFloatingPanel.classList.add("hidden");
    });
    floatStopBtn.addEventListener("click", () => {
         if(!currentGameCode) return;
         socket.emit("endRound", { gameCode: currentGameCode });
         adminFloatingPanel.classList.add("hidden");
    });



    // --- × ×™×”×•×œ ×××©×§ ×× ×”×œ ---

    function collectCategories() {
      const selected = [];
      catCheckboxes.forEach((cb) => { if (cb.checked) selected.push(cb.value); });
      return selected;
    }

    selectAllCatsCheckbox.addEventListener("change", () => {
        catCheckboxes.forEach(cb => cb.checked = selectAllCatsCheckbox.checked);
    });

    function refreshDropdowns(game) {
        if (!game || !game.teams) return;
        const teams = game.teams;
        const populate = (selectEl, includeAuto) => {
            const oldVal = selectEl.value;
            selectEl.innerHTML = includeAuto ? '<option value="">×‘×—×™×¨×” ××•×˜×•××˜×™×ª</option>' : '<option value="">×‘×—×¨ ×§×‘×•×¦×”...</option>';
            Object.entries(teams).forEach(([tid, t]) => {
                const opt = document.createElement("option");
                opt.value = tid; opt.textContent = t.name || tid; selectEl.appendChild(opt);
            });
            if (oldVal && teams[oldVal]) selectEl.value = oldVal;
            else if (!includeAuto && Object.keys(teams).length > 0) selectEl.value = Object.keys(teams)[0];
        };
        populate(roundTeamSelect, false);
        populate(inviteTeamSelect, false);
        populate(hostPlayerTeamSelect, false);
        refreshExplainerOptions();
    }

    function refreshExplainerOptions() {
      const teamId = roundTeamSelect.value;
      explainerSelect.innerHTML = '<option value="">×‘×—×™×¨×” ××•×˜×•××˜×™×ª ×¢"×™ ×”××¢×¨×›×ª</option>';
      if (!teamId || !lastGameState || !lastGameState.teams) return;
      const team = lastGameState.teams[teamId];
      const playersMap = lastGameState.playersByClientId || {};
      if (Array.isArray(team.players)) {
          team.players.forEach(cid => {
              const p = playersMap[cid];
              if(p) { const opt = document.createElement("option"); opt.value = cid; opt.textContent = p.name; explainerSelect.appendChild(opt); }
          });
      }
    }
    roundTeamSelect.addEventListener("change", refreshExplainerOptions);

    function updateTimers(game) {
        clearInterval(roundTimerInterval);
        if (!game || !game.currentRound || !game.currentRound.isActive) {
            roundTimerEl.textContent = "--:--";
            hostPlayerBigTimerEl.textContent = "--:--";
            roundStatusEl.textContent = "××™×Ÿ ×¡×™×‘×•×‘ ×¤×¢×™×œ ×›×¨×’×¢";
            startRoundBtn.disabled = false; stopRoundBtn.disabled = true;
            floatStartBtn.disabled = false; floatStopBtn.disabled = true;
            return;
        }
        startRoundBtn.disabled = true; stopRoundBtn.disabled = false;
        floatStartBtn.disabled = true; floatStopBtn.disabled = false;

        let secondsLeft = game.currentRound.secondsLeft || 0;
        const updateDisplay = () => {
            const timeStr = formatTime(secondsLeft);
            roundTimerEl.textContent = timeStr;
            hostPlayerBigTimerEl.textContent = timeStr;
        };
        updateDisplay();
        if (secondsLeft > 0) {
            roundTimerInterval = setInterval(() => {
                secondsLeft--; updateDisplay();
                if (secondsLeft <= 0) clearInterval(roundTimerInterval);
            }, 1000);
        }

        const r = game.currentRound;
        const teamName = game.teams[r.teamId]?.name || r.teamId;
        roundStatusEl.innerHTML = `×¡×™×‘×•×‘ ×¤×¢×™×œ: <strong>${teamName}</strong> | ××¡×‘×™×¨: ${r.explainerName} | × ×™×§×•×“: ${r.roundScore}`;
    }


    // --- × ×™×”×•×œ ××¦×‘ ×©×—×§×Ÿ-×× ×”×œ ---

    function updateHostPresenterUI() {
        if (!hostIsCurrentExplainer) { hostPresenterSection.classList.add("hidden"); return; }
        hostPresenterSection.classList.remove("hidden");
        if (!hostCurrentWord) {
            hostPresenterWordEl.textContent = "×˜×•×¢×Ÿ ××™×œ×”...";
            hostPresenterCategoryEl.textContent = "...";
            hostBtnCorrect.disabled = true; hostBtnSkip.disabled = true;
        } else {
            hostPresenterWordEl.textContent = hostCurrentWord;
            const catMap = { general: '×›×œ×œ×™', animals:'×—×™×•×ª', food:'××•×›×œ', objects:'×—×¤×¦×™×', technology:'×˜×›× ×•×œ×•×’×™×”', family:'××©×¤×—×”', travel:'×˜×™×•×œ×™×', sports:'×¡×¤×•×¨×˜', entertainment:'×‘×™×“×•×¨', music:'××•×–×™×§×”', nature:'×˜×‘×¢', holidays:'×—×’×™×', school:'×œ×™××•×“×™×', work:'×¢×‘×•×“×”', hard:'×§×©×”' };
            hostPresenterCategoryEl.textContent = catMap[hostCurrentCategory] || hostCurrentCategory || '×›×œ×œ×™';
            hostBtnCorrect.disabled = false; hostBtnSkip.disabled = false;
        }
    }

    function requestNextWordForHost() {
        hostBtnCorrect.disabled = true; hostBtnSkip.disabled = true;
        socket.emit("getNextWord", { gameCode: currentGameCode }, (resp) => {
            if (resp && resp.ok) {
                hostCurrentWord = resp.word; hostCurrentCategory = resp.category;
                updateHostPresenterUI();
            }
        });
    }

    function renderHostPlayerView(game) {
        if (!isHostAlsoPlayer || !hostPlayerClientId) {
            hostPlayerJoinCard.classList.remove("hidden"); hostPlayerGameCard.classList.add("hidden"); return;
        }
        hostPlayerJoinCard.classList.add("hidden"); hostPlayerGameCard.classList.remove("hidden");

        const me = game.playersByClientId[hostPlayerClientId];
        if (!me) {
            // ×× ×”×©×—×§×Ÿ × ××—×§, × ××¤×¡ ××¦×‘
            isHostAlsoPlayer = false; hostPlayerClientId = null; localStorage.removeItem(LS_HOST_PLAYER_DATA);
            renderHostPlayerView(game); return;
        }
        hostPlayerTeamId = me.teamId;
        const myTeam = game.teams[hostPlayerTeamId];
        hostPlayerGameInfo.innerHTML = `××—×•×‘×¨ ×›×©×—×§×Ÿ: <strong>${me.name}</strong>`;
        hostPlayerTeamNameEl.textContent = myTeam?.name || hostPlayerTeamId;
        const teamPlayers = myTeam?.players.map(cid => game.playersByClientId[cid]?.name).filter(Boolean) || [];
        hostPlayerTeamPlayersEl.textContent = teamPlayers.join(", ") || "×××ª×™×Ÿ ×œ×©×—×§× ×™×...";

        // ×˜×‘×œ×ª × ×™×§×•×“ ×œ×©×—×§×Ÿ
        hostPlayerScoreboardEl.innerHTML = Object.values(game.teams)
          .map(t => `<div style="display:flex; justify-content:space-between;"><span>${t.name || t.id}</span><strong>${t.score}</strong></div>`)
          .join("");

        // ×¡×˜×˜×•×¡ ×¡×™×‘×•×‘ ×œ×©×—×§×Ÿ
        const r = game.currentRound;
        if (r && r.isActive) {
             const explainerTeamName = game.teams[r.teamId]?.name || r.teamId;
             let statusHtml = `×‘×¡×‘×‘: <strong>${explainerTeamName}</strong><br>××¡×‘×™×¨/×”: ${r.explainerName}<br>× ×™×§×•×“ ×‘×¡×‘×‘: ${r.roundScore}`;
             if(r.teamId === hostPlayerTeamId) statusHtml += " <span style='color:#F84779; display:block; margin-top:4px;'>×”×§×‘×•×¦×” ×©×œ×š! ğŸ¯</span>";
             hostRoundStatusPlayerEl.innerHTML = statusHtml;

             hostIsCurrentExplainer = (r.explainerId === hostPlayerClientId);
             if (hostIsCurrentExplainer) {
                 const roundKey = r.startedAt + r.teamId;
                 if (roundKey !== hostLastRoundKey) {
                     hostLastRoundKey = roundKey; hostCurrentWord = null; requestNextWordForHost();
                 } else { updateHostPresenterUI(); }
             } else { hostPresenterSection.classList.add("hidden"); }
        } else {
             hostRoundStatusPlayerEl.textContent = "×××ª×™×Ÿ ×œ×ª×—×™×œ×ª ×¡×‘×‘...";
             hostPresenterSection.classList.add("hidden");
        }
    }


    // --- ×¤×•× ×§×¦×™×™×ª ×¢×œ: ×¢×“×›×•×Ÿ ×›×œ ×”×××©×§ ---

    function renderGameState(game) {
        lastGameState = game;
        if (!game) {
            createGameCard.classList.remove("hidden"); activeGameControls.classList.add("hidden");
            floatingNav.classList.add("hidden"); adminFab.classList.add("hidden"); adminFloatingPanel.classList.add("hidden");
            currentGameCode = null; isHostAlsoPlayer = false;
            tabHost.click();
            return;
        }

        currentGameCode = game.code;
        createGameCard.classList.add("hidden"); activeGameControls.classList.remove("hidden");
        gameCodeDisplay.textContent = game.code;
        scoreTargetDisplay.textContent = `(×™×¢×“: ${game.targetScore})`;
        floatingNav.classList.remove("hidden"); // <--- ×ª×™×§×•×Ÿ ×ª×§×œ×” 2: ×”×¦×’×ª × ×™×•×•×˜

        refreshDropdowns(game);
        updateTimers(game);

        // ×˜×‘×œ×ª × ×™×§×•×“ ×× ×”×œ
        scoreboardEl.innerHTML = "";
        Object.values(game.teams).forEach(t => {
             const row = document.createElement("div"); row.className = "team-row";
             row.innerHTML = `<span>${t.name}</span><span>${t.score}</span>`;
             scoreboardEl.appendChild(row);
        });

        // ×¨×©×™××ª ×©×—×§× ×™× ×œ×× ×”×œ
        playersByTeamEl.innerHTML = "";
        Object.values(game.teams).forEach(t => {
            const wrap = document.createElement("div"); wrap.style.marginBottom="12px";
            wrap.innerHTML = `<div style="font-weight:600; margin-bottom:6px;">${t.name}:</div>`;
            const list = document.createElement("div");
            t.players.forEach(cid => {
                const p = game.playersByClientId[cid];
                const pill = document.createElement("span"); pill.className = "player-pill";
                pill.innerHTML = `<span>${p.name}</span><button class="remove-player-btn" onclick="removePlayer('${cid}')">Ã—</button>`;
                list.appendChild(pill);
            });
            wrap.appendChild(list.children.length ? list : document.createTextNode("××™×Ÿ ×©×—×§× ×™×"));
            playersByTeamEl.appendChild(wrap);
        });

        renderHostPlayerView(game);
        updateNavButtons();
    }

    function updateNavButtons() {
        if (hostMode.classList.contains("hidden")) {
            floatingToPlayer.classList.add("hidden"); floatingToHost.classList.remove("hidden");
            if (isHostAlsoPlayer && adminFloatingPanel.classList.contains("hidden")) adminFab.classList.remove("hidden");
        } else {
            floatingToHost.classList.add("hidden"); floatingToPlayer.classList.remove("hidden");
            adminFab.classList.add("hidden"); adminFloatingPanel.classList.add("hidden");
        }
    }


    // --- ××™×¨×•×¢×™× (Events) ---

    // ×™×¦×™×¨×ª ××©×—×§
    createGameBtn.addEventListener("click", () => {
        const hostName = hostNameInput.value.trim();
        if (!hostName) { hostStatus.textContent = "× × ×œ×”×–×™×Ÿ ×©× ×× ×”×œ"; return; }
        const teamNames = { A: teamNameInputs.A.value.trim(), B: teamNameInputs.B.value.trim(), C: teamNameInputs.C.value.trim(), D: teamNameInputs.D.value.trim(), E: teamNameInputs.E.value.trim() };
        socket.emit("createGame", {
            hostName, numTeams: numTeamsSelect.value, targetScore: targetScoreInput.value,
            roundSeconds: roundSecondsInput.value, categories: collectCategories(), teamNames
        }, (resp) => {
            if (resp.ok) {
                localStorage.setItem(LS_HOST_GAME_KEY, resp.gameCode);
                renderGameState(resp.game);
                hostPlayerNameInput.value = hostName;
                if (roundSecondsInline) roundSecondsInline.value = roundSecondsInput.value;
            } else { hostStatus.textContent = resp.error || "×©×’×™××” ×‘×™×¦×™×¨×”"; }
        });
    });

    // ×¡×’×™×¨×ª ××©×—×§
    endGameBtn.addEventListener("click", () => {
        if(confirm("×œ×¡×’×•×¨ ××ª ×”××©×—×§ ×œ×›×•×œ×?")) socket.emit("endGame", { gameCode: currentGameCode });
    });

    // ×‘×§×¨×ª ×¡×™×‘×•×‘
    startRoundBtn.addEventListener("click", () => {
        socket.emit("startRound", { gameCode: currentGameCode, teamId: roundTeamSelect.value, roundSeconds: roundSecondsInline.value, explainerClientId: explainerSelect.value });
    });
    stopRoundBtn.addEventListener("click", () => { socket.emit("endRound", { gameCode: currentGameCode }); });

    // ×”×¡×¨×ª ×©×—×§×Ÿ
    window.removePlayer = (cid) => {
        if(confirm("×œ×”×¡×™×¨ ×©×—×§×Ÿ ×–×”?")) socket.emit("removePlayer", { gameCode: currentGameCode, clientId: cid });
    };

    // ×”×–×× ×ª ×•×•×¦××¤
    whatsappInviteBtn.addEventListener("click", () => {
        const tid = inviteTeamSelect.value; if(!tid) return alert("×‘×—×¨ ×§×‘×•×¦×” ×œ×”×–×× ×”");
        const tName = lastGameState.teams[tid].name;
        const link = `${window.location.origin}/player.html?code=${currentGameCode}&teamId=${tid}&teamName=${encodeURIComponent(tName)}&autoJoin=1`;
        const text = `ğŸ”¥ ××•×–×× ×™× ×œ××©×—×§ ××™×œ×× ×™×”!\n×œ×”×¦×˜×¨×¤×•×ª ×œ×§×‘×•×¦×ª "${tName}" ×œ×—×¦×• ×¢×œ ×”×§×™×©×•×¨:\n${link}`;
        window.open("https://wa.me/?text=" + encodeURIComponent(text));
    });

    // ××¢×‘×¨ ×˜××‘×™×
    tabHost.addEventListener("click", () => {
        tabHost.classList.add("active"); tabPlayer.classList.remove("active");
        hostMode.classList.remove("hidden"); playerMode.classList.add("hidden");
        updateNavButtons();
    });
    tabPlayer.addEventListener("click", () => {
        tabPlayer.classList.add("active"); tabHost.classList.remove("active");
        hostMode.classList.add("hidden"); playerMode.classList.remove("hidden");
        updateNavButtons();
    });
    floatingToPlayer.addEventListener("click", () => tabPlayer.click());
    floatingToHost.addEventListener("click", () => tabHost.click());

    // ×”×¦×˜×¨×¤×•×ª ×”×× ×”×œ ×›×©×—×§×Ÿ
    openPlayerViewBtn.addEventListener("click", () => {
        const name = hostPlayerNameInput.value.trim(); const tid = hostPlayerTeamSelect.value;
        if(!name || !tid) return alert("× × ×œ××œ× ×©× ×•×§×‘×•×¦×”");
        socket.emit("joinGame", { gameCode: currentGameCode, name, teamId: tid }, (resp) => {
            if(resp.ok) {
                isHostAlsoPlayer = true; hostPlayerClientId = resp.clientId;
                localStorage.setItem(LS_HOST_PLAYER_DATA, JSON.stringify({ gameCode: currentGameCode, clientId: resp.clientId }));
                renderGameState(resp.game);
            } else { alert(resp.error); }
        });
    });

    // ×›×¤×ª×•×¨×™ ××¡×‘×™×¨
    hostBtnCorrect.addEventListener("click", () => { if(hostIsCurrentExplainer) socket.emit("changeRoundScore", { gameCode: currentGameCode, delta: 1 }, requestNextWordForHost); });
    hostBtnSkip.addEventListener("click", () => { if(hostIsCurrentExplainer) socket.emit("changeRoundScore", { gameCode: currentGameCode, delta: -1 }, requestNextWordForHost); });


    // --- ×¡×•×§×˜×™× ---

    socket.on("gameUpdated", renderGameState);
    socket.on("gameEnded", () => {
        localStorage.removeItem(LS_HOST_GAME_KEY); localStorage.removeItem(LS_HOST_PLAYER_DATA);
        renderGameState(null);
        showModal("×”××©×—×§ ×”×¡×ª×™×™×", "×ª×•×“×” ×©×©×™×—×§×ª×!");
    });

    // <--- ×ª×™×§×•×Ÿ ×ª×§×œ×•×ª 6, 7: ×©×™××•×© ×‘××•×“×œ ××¢×•×¦×‘ ×‘××§×•× alert
    socket.on("roundTimeUp", (data) => {
        if (!data) return;
        const score = data.roundScore || 0;
        const teamName = data.teamName || "×”×§×‘×•×¦×”";

        let title = "â° ×”×–××Ÿ × ×’××¨!";
        let body = `<div style="font-size:1.3rem; font-weight:800; margin-bottom:12px; color:#F84779;">${teamName}</div>`;
        if (score <= 4) body += "×œ× × ×•×¨×, ××ª× ×¢×“×™×™×Ÿ ××ª×—×××™×... ğŸ§Š";
        else if (score <= 9) body += "×¡×‘×‘ ×¡×‘×‘×” ×œ×’××¨×™! ğŸ‘";
        else body += "×•×•××•! ×©×™×—×§×ª× ××•×ª×” ×‘×¢× ×§! ğŸ”¥";
        body += `<div style="margin-top:20px; font-size:1.6rem; font-weight:800; color:#2B1E4A; background:#F8F7FF; padding:12px; border-radius:16px;">× ×™×§×•×“ ×‘×¡×‘×‘: ${score}</div>`;

        showModal(title, body);
        hostIsCurrentExplainer = false; hostPresenterSection.classList.add("hidden");
    });


    // --- ××ª×—×•×œ ---

    (function init() {
        // ×˜×¢×™× ×ª ×œ×•×’×• ×•×‘×× ×¨
        fetch("/api/banners").then(r=>r.json()).then(d => {
            if(d.logo?.imageUrl) { hostLogoEl.src=d.logo.imageUrl; hostLogoEl.classList.remove("hidden"); }
            if(d.host?.imageUrl) hostBannerSlot.innerHTML = `<a href="${d.host.linkUrl}" target="_blank"><img src="${d.host.imageUrl}" style="max-width:100%; border-radius:16px;"></a>`;
        }).catch(()=>{});

        // ×©×—×–×•×¨ ××¦×‘
        const storedCode = localStorage.getItem(LS_HOST_GAME_KEY);
        if (storedCode) {
            socket.emit("hostReconnect", { gameCode: storedCode }, (resp) => {
                if (resp.ok) {
                    const playerData = JSON.parse(localStorage.getItem(LS_HOST_PLAYER_DATA));
                    if(playerData && playerData.gameCode === storedCode) {
                        isHostAlsoPlayer = true; hostPlayerClientId = playerData.clientId;
                    }
                    renderGameState(resp.game);
                } else {
                    localStorage.removeItem(LS_HOST_GAME_KEY); localStorage.removeItem(LS_HOST_PLAYER_DATA);
                    renderGameState(null);
                }
            });
        } else { renderGameState(null); }
    })();

  </script>
</body>
</html>
